/*function DisplayEventMessage(t){alert(t.eventName+" event happened")}function _cb(){0==$("#commentsBox").children().length?setTimeout(_cb,3e3):update_css()}function _cb2(){0==$(".gig-comments-container.gig-comments-loginbox").children().length?setTimeout(_cb2,100):update_css2()}function update_css(){$("#commentsBox").css("margin","0 auto"),$("#commentsBox").css("width","100%"),$("#commentsBox").css("padding","0 0"),$(".gig-comments-textarea").css("font-size","16px"),$(".gig-comments-dialog").css("min-width",320),$(".gig-comments-share-provider").css("padding","4px 5px"),$(".gig-comments-textarea").focus(function(){_GLOBAL.commentFocus=!0}).focusout(function(){_GLOBAL.commentFocus=!1})}function printResponse(t){if(0==t.errorCode){var e=t.user,i=t.UID,n=t.isSiteUser;"User "+e.nickname+" is from "+e.loginProvider+"UID:"+i+"isSiteUser:"+n;i||alert("Please log in to comment!")}else console.log("Error :"+t.errorMessage)}function update_css2(){$(".gig-comments-container.gig-comments-loginbox").css("display","none")}function BeforeCommentSubmitted_handle(t){console.log("before")}function onCommentSubmitted_handle(t){console.log("on submited")}function SOCIAL_BTNS(t){function e(){window.prompt("Select all and press 'Copy'",location.href)}var i=0,n=t.find(".btn_social"),o=t.find(".sc_item2");this.init=function(){n.click(function(){i?($(this).fadeIn("fast").css("display","inline-block"),o.hide(),i=0):($(this).hide(),o.fadeIn("fast").css("display","inline-block"),i=1)}),t.find(".sc_item.fb").click(function(){window.open("http://www.facebook.com/share.php?u=".concat(encodeURIComponent(location.href)))}),t.find(".sc_item.twr").click(function(){window.open("https://twitter.com/share?url="+encodeURIComponent(location.href)+"&via=TomoNewsUS&text="+_GLOBAL.title)}),t.find(".sc_item.email").click(function(){window.location.href="mailto:?subject="+_GLOBAL.title+"&body="+encodeURIComponent(location.href)}),t.find(".sc_item.url").click(function(){e()}),t.find(".sc_item.gplus").click(function(){window.open("https://plus.google.com/share?url="+encodeURIComponent(location.href))}),t.find(".sc_item.stum").click(function(){window.open("http://www.stumbleupon.com/submit?url="+encodeURIComponent(location.href)+"&title="+_GLOBAL.title)}),t.find(".sc_item.reddit").click(function(){window.open("http://reddit.com/submit?url="+encodeURIComponent(location.href)+"&title="+_GLOBAL.title)})}}function STORY_POP(){function t(){}var e,i=$(".nxt_vdo"),n=$("#ad2"),o=this,s=i.find(".btn_left"),a=i.find(".btn_right");this.state={visible:0,index:1},this.init=function(){e=_storyp_view.get_total(),$(".nxt_vdo_item .nxt_vdo_right  .txt .txtline").ellipsis({row:2,"char":"..."}),$(".nxt_vdo_item .nxt_vdo_right  .txt .txtline").css("height",24),o.state.visible||o.hide(),o.reset(),a.click(function(){"port"==_GLOBAL.orient?o.state.index<e?o.state.index++:o.state.index=1:o.state.index+2<e?o.state.index+=2:o.state.index=1,o.updateAll()}),s.click(function(){"port"==_GLOBAL.orient?o.state.index>1?o.state.index--:o.state.index=e:o.state.index-2>=1?o.state.index-=2:o.state.index=e-1,o.updateAll()}),$("#disqus").appear(),$("body").on("appear","#disqus",function(t){"down"==_GLOBAL.scroll_Direct&&(o.state.visible||(o.show(),o.state.visible=1))}),$("#vdo_otherlist").appear(),$("body").on("appear","#vdo_otherlist",function(t){"down"==_GLOBAL.scroll_Direct&&(o.state.visible||(o.show(),o.state.visible=1))})},this.show=function(){TweenMax.to(i,.2,{y:0,opacity:1}),o.state.visible=1,"port"==_GLOBAL.orient?TweenMax.to(n,.2,{y:0,opacity:1}):TweenMax.to(n,.2,{y:50,opacity:1})},this.hide=function(){TweenMax.to(i,.2,{y:100,opacity:1}),o.state.visible=0,TweenMax.to(n,.2,{y:0,opacity:1})},this.updateAll=function(){console.log("updateAll");var e=279;"port"==_GLOBAL.orient?(e=279,i.find(".nxt_vdo_slide").animate({left:21-(o.state.index-1)*e},300),i.find(".nxt_vdo_slide .nxt_vdo_item").each(function(){var t=$(this).data("id");t==parseInt(o.state.index)?TweenMax.to($(this),.5,{opacity:1}):TweenMax.to($(this),.5,{opacity:0})})):(i.find(".nxt_vdo_slide").animate({left:(21-(o.state.index-1)*e)*_GLOBAL.ratioScreen2},300),i.find(".nxt_vdo_slide .nxt_vdo_item").each(function(){var t=$(this).data("id");t==parseInt(o.state.index)||t==parseInt(o.state.index)+1?TweenMax.to($(this),.5,{opacity:1}):TweenMax.to($(this),.5,{opacity:0})})),t()},this.reset=function(){console.log("resete"),o.state.index=1,o.updateAll()}}function STORY_POP_VIEW(){function t(){var t;$getUrls=cnf_storypop.getUrls5,$.ajax({url:$getUrls,type:"get",dataType:"jsonp",success:function(s){var c;try{c=s.list[0].media.length>0?s.list[0].media.length:0,a=c}catch(d){console.log("no data!"),c=0}for(var l=0;c>l;l++){$vid=s.list[0].media[l].id,$date=s.list[0].media[l].creationDate.substring(0,10),$date=$date.replace(/\-/g,"/"),$num=s.list[0].media[l].tags[0].tag.length,$view=s.list[0].media[l].mediaPlays.total,$NSFW_v=!1;for(var r=0;r<$num;r++)"category"==s.list[0].media[l].tags[0].tag[r].ns&&($cate_name=s.list[0].media[l].tags[0].tag[r].value),"mobile"==s.list[0].media[l].tags[0].tag[r].ns&&"headline"==s.list[0].media[l].tags[0].tag[r].predicate&&($mobile_headline=s.list[0].media[l].tags[0].tag[r].value),"NSFW"==s.list[0].media[l].tags[0].tag[r].ns&&"NSFW"==s.list[0].media[l].tags[0].tag[r].value&&($NSFW_v=!0);n.push($mobile_headline),o.push($vid),t="http://media-ssl.nextmedia.com/media-images-586/media/"+$vid,$NSFW_v&&_GLOBAL.NSFW?i.push(t+_GLOBAL.NSSQ_CDN+"/cropped/128x128.jpg"):i.push(t+"/square/cropped/128x128.jpg")}c>0&&e()}}).done(function(){})}function e(){for(var t=$(".nxt_vdo_slide"),e=0;e<i.length;e++){var s=e+1,a='<a href="'+_GLOBAL.base+remove_punc(n[e])+"-"+o[e]+'"><div class= "nxt_vdo_item" data-id="'+s+'"><div class="nxt_vdo_img"><img src="'+i[e]+'" width="49"></div><div class="nxt_vdo_right"><div class="title">WATCH NEXT</div><div class="txt"><span class="txtline">'+n[e]+"</span></div></div></div></a>";t.append(a)}cnf_storypop.callback()}var i,n,o,s,a;this.get_total=function(){return a},this.init=function(){console.log("OPP _VIEW"),i=[],n=[],o=[],s=[],t()}}*/

function DisplayEventMessage(t) {
    alert(t.eventName + " event happened")
}

function _cb() {
    0 == $("#commentsBox").children().length ? setTimeout(_cb, 3e3) : update_css()
}

function _cb2() {
    0 == $(".gig-comments-container.gig-comments-loginbox").children().length ? setTimeout(_cb2, 100) : update_css2()
}

function update_css() {
    $("#commentsBox").css("margin", "0 auto"), $("#commentsBox").css("width", "100%"), $("#commentsBox").css("padding", "0 0"), $(".gig-comments-textarea").css("font-size", "16px"), $(".gig-comments-dialog").css("min-width", 320), $(".gig-comments-share-provider").css("padding", "4px 5px"), $(".gig-comments-textarea").focus(function() {
        _GLOBAL.commentFocus = !0
    }).focusout(function() {
        _GLOBAL.commentFocus = !1
    })
}

function printResponse(t) {
    if (0 == t.errorCode) {
        var e = t.user,
            i = t.UID,
            n = t.isSiteUser;
        "User " + e.nickname + " is from " + e.loginProvider + "UID:" + i + "isSiteUser:" + n;
        i || alert("Please log in to comment!")
    } else console.log("Error :" + t.errorMessage)
}

function update_css2() {
    $(".gig-comments-container.gig-comments-loginbox").css("display", "none")
}

function BeforeCommentSubmitted_handle(t) {
    console.log("before")
}

function onCommentSubmitted_handle(t) {
    console.log("on submited")
}

function STORY_POP() {
    function t() {}
    var e, i = $(".nxt_vdo"),
        n = $("#ad2"),
        o = this,
        s = i.find(".btn_left"),
        a = i.find(".btn_right");
    this.state = {
        visible: 0,
        index: 1
    }, this.init = function() {
        e = 10/*_storyp_view.get_total()*/, $(".nxt_vdo_item .nxt_vdo_right  .txt .txtline").ellipsis({
            row: 5,
            "char": "..."
        }), $(".nxt_vdo_item .nxt_vdo_right  .txt .txtline").css("height", 70), o.state.visible || o.hide(), o.reset(), a.click(function() {
            "port" == _GLOBAL.orient ? o.state.index < e ? o.state.index++ : o.state.index = 1 : o.state.index + 2 < e ? o.state.index += 2 : o.state.index = 1, o.updateAll()
        }), s.click(function() {
            "port" == _GLOBAL.orient ? o.state.index > 1 ? o.state.index-- : o.state.index = e : o.state.index - 2 >= 1 ? o.state.index -= 2 : o.state.index = e - 1, o.updateAll()
        })/*,$("#scbar_top").appear(), $("body").on("appear", "#scbar_top", function(t) {
            "down" == _GLOBAL.scroll_Direct && (o.state.visible || (o.show(), o.state.visible = 1))
        }), $("#vdo_otherlist").appear(), $("body").on("appear", "#vdo_otherlist", function(t) {
            "down" == _GLOBAL.scroll_Direct && (o.state.visible || (o.show(), o.state.visible = 1))
        })*/
    }, this.show = function() {
        TweenMax.to(i, .1, {
            y: 0,
            opacity: 1
        }), o.state.visible = 1, "port" == _GLOBAL.orient ? TweenMax.to(n, .1, {
            y: 0,
            opacity: 1
        }) : TweenMax.to(n, .1, {
            y: 50,
            opacity: 1
        })
    }, this.hide = function() {
        TweenMax.to(i, .2, {
            y: 0,
            opacity: 1
        }), o.state.visible = 0, TweenMax.to(n, .2, {
            y: 0,
            opacity: 1
        })
    }, this.updateAll = function() {
        console.log("updateAll");
        var e = 314;
        "port" == _GLOBAL.orient ? (e = 314, i.find(".nxt_vdo_slide").animate({
            left: 5 - (o.state.index - 1) * e
        }, 319), i.find(".nxt_vdo_slide .nxt_vdo_item").each(function() {
            var t = $(this).data("id");
            t == parseInt(o.state.index) ? TweenMax.to($(this), .5, {
                opacity: 1
            }) : TweenMax.to($(this), .5, {
                opacity: 0
            })
        })) : (i.find(".nxt_vdo_slide").animate({
            left: (5 - (o.state.index - 1) * e) * _GLOBAL.ratioScreen2
        }, 319), i.find(".nxt_vdo_slide .nxt_vdo_item").each(function() {
            var t = $(this).data("id");
            t == parseInt(o.state.index) || t == parseInt(o.state.index) + 1 ? TweenMax.to($(this), .5, {
                opacity: 1
            }) : TweenMax.to($(this), .5, {
                opacity: 0
            })
        })), t()
    }, this.reset = function() {
        //console.log("resete"), o.state.index = 1, o.updateAll()
    }
}

function STORY_POP_VIEW() {
    function t() {
        var t;
		var sdate = '*';
		var edate=Math.round((new Date()).getTime() / 1000);
        //$getUrls = cnf_storypop.getUrls5;
		$.ajax({
            /*url: cnf_storypop.baseUrl + 'anvato_playlist.php',
            type: "GET",
			data: {url : $getUrls}, 
            dataType: "json",*/
			url: 'http://api.nm.anvato.net/v2/feed/KBJRKBD5PNUFPGRALF?start=0&count=22&filters[]=c_ts_publish_l:['+sdate+'%20TO%20'+edate+']&sort=c_ts_publish_l+desc',
			type: "post",
            dataType: "json",
            success: function(s) {
				var c;
				var videos = s.docs;
				var k = 0;
				var video_id = _GLOBAL.video_id;
				c = (videos.length > 0 )? videos.length :0, a=c ;
				
				for (var l = 0; l < c; l++) {
					vid = videos[l].obj_id;	
					
					if (video_id != vid){
						NSFW_v = !1;
						mobile_headline={};
						mobile_headline.tit = videos[l].c_title_s; 
						cate_id = videos[l].c_category_smv;
						cate_name = checkmenuAry(cate_id);
						date = videos[l].c_ts_published_l, date = $.datepicker.formatDate('yy/mm/dd', date);
						var thumbnail, thumb;
						thumbnail = videos[l].thumbnails;

						for(var j = 0 ; j<thumbnail.length; j++){

							if( thumbnail[j]['role']=='Thumbnail' && thumbnail[j]['width']=='348'){ thumb = thumbnail[j]['url']; break; }
							else if( thumbnail[j]['role']=='poster' ){  thumb = thumbnail[j]['url']; break; }
						
						}
						
						if( videos[l]['u_NSFW_Tag_s'] && videos[l]['u_NSFW_Tag_s']=='NSFW' ){  NSFW_v = true; }
								
						n.push(mobile_headline.tit);
						o.push(vid);
						t = thumb; 
						i.push(t);
						
						k++;
						if (k == 10){ break; }
					}	
					
				}
				c > 0 && e()	
				
            }
        }).done(function() {})
			  
  
    }

    function e() {
		for (var t = $(".nxt_vdo_slide"), e = 0; e < i.length; e++) {
			
            var s = e + 1,
                a = '<a href="' + _GLOBAL.base + n[e] + "-" + o[e] + '"><div class= "nxt_vdo_item" data-id="' + s + '"><div class="nxt_vdo_img"><img src="' + i[e] + '" width="49"></div><div class="nxt_vdo_right"><div class="title">Next on TomoNews</div><div class="txt"><span class="txtline">' + n[e] + "</span></div></div></div></a>";
            t.append(a)
		}
        cnf_storypop.callback()
    }
    
	var i, n, o, s, a;
    
	this.get_total = function() {
        return a
    }
	
	this.init = function() {
        console.log("OPP _VIEW"), i = [], n = [], o = [], s = [], t()
    }
	
	function checkmenuAry(title){
      menuAry= [];
      menuAry['U.S.']='4476';
      menuAry['World']='4477';
      menuAry['Asia']='4478';
      menuAry['Sci & Tech']='4485';
      menuAry['Sports']='4479';
      menuAry['Entertainment']='4480';
      menuAry['Politics']='4481';
      menuAry['Geek']='4482';
      menuAry['TomoGirls']='4483';
      menuAry['Society']='4484';
      menuAry['Chinese']='4486';
      menuAry['No Comment']='4487';
      menuAry['Tomo Originals']='4489';
	var _key;
	
	for(var key in menuAry) {
		if (menuAry[key] == title){
			_key = key;
		}
	};

    return  _key;

  }
}

 function IMG_LOAD(){
        var imagesN = $("body img").length;      
        var $imgs = $('body img'), count = 0;
        $imgs.imagesLoaded().progress(function(instance, image){
            count ++;
            percent = Math.round(count/$imgs.length*100);
            if(count == $imgs.length){
                  $(".headline_img").each(function (){
                     var _ww= parseInt($(this).find(".origin_img").css('width'));      
                     var _hh= parseInt($(this).find(".origin_img").css('height'));  
                     var _r = 600/680;
                     var target_w ;
                     if(_ww/_hh > _r)
                     {
                        $(this).find(".origin_img").animate({width:"600px"} ,500);
                        target_w = 600
                     }
                     else
                     {
                        $(this).find(".origin_img").animate({height:"680px"} ,500);
                        target_w =Math.round( _ww/_hh * 680);
                     }
                       $(this).find(".headline_tite").css('width' , target_w);
                  })
                  _img_slider=new SLIDER_POP();
                  _img_slider.initialize();
            }
        });
	}